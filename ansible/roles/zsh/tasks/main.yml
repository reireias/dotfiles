---
# zsh
- name: install dependency packages for Debian
  apt:
    name:
      - zsh
      - curl
      - gawk
    update_cache: true
  become: true
  when: ansible_facts['os_family'] == 'Debian'

- name: install dependency packages for Mac
  homebrew:
    name:
      - zsh
      - curl
      - gawk
      - coreutils
  when: ansible_facts['os_family'] == 'Darwin'

# zplug
- name: check zplug exist
  stat:
    path: ~/.zplug
  register: zplug

- name: zplug install block
  block:
  - name: download zplug install script
    get_url:
      url: https://raw.githubusercontent.com/zplug/installer/master/installer.zsh
      dest: /tmp/zplug-installer.zsh
      mode: 0644

  - name: install zplug
    command: zsh /tmp/zplug-installer.zsh
    register: zplug
    changed_when: zplug.rc != 0
  when: not zplug.stat.exists
