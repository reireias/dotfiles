---
# zsh
- name: install dependency packages for Debian
  apt:
    name:
      - zsh
      - curl
      - gawk
    update_cache: true
  become: true
  when: ansible_facts['os_family'] == 'Debian'

- name: install dependency packages for Mac
  homebrew:
    name:
      - zsh
      - curl
      - gawk
      - coreutils
  when: ansible_facts['os_family'] == 'Darwin'

# zplug
- name: check zinit exist
  stat:
    path: ~/.local/share/zinit
  register: zinit

- name: zinit install block
  block:
  - name: download zinit install script
    get_url:
      url: https://raw.githubusercontent.com/zdharma-continuum/zinit/HEAD/scripts/install.sh
      dest: /tmp/zinit-installer.zsh
      mode: 0644

  - name: install zinit
    command: zsh /tmp/zinit-installer.zsh
    register: install
    changed_when: install.rc != 0
    environment:
      NO_EDIT: "1"

  - name: compile
    command: zsh -c "zinit self-update"
    register: compile
    changed_when: compile.rc != 0

  when: not zinit.stat.exists
